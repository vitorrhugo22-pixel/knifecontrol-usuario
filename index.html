<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KnifeControl Usu√°rio ‚Äî Envio ao Google Forms (corrigido)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; margin: 0; padding: 0; }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px);} to { opacity: 1; transform: translateY(0);} }
    .badge { display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:9999px; font-size:12px; }
    .badge-green { background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; }
    .badge-yellow { background:#fffbeb; color:#92400e; border:1px solid #fde68a; }
    .badge-red { background:#fef2f2; color:#991b1b; border:1px solid #fecaca; }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Login -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
      <div class="bg-white rounded-2xl shadow-2xl p-8">
        <div class="text-center mb-6">
          <h1 class="text-3xl font-bold text-gray-800 mb-2">üî™ KnifeControl</h1>
          <p class="text-gray-600 mt-2">Sistema de Controle ‚Äî <span class="font-semibold">Google Forms integrado</span></p>
        </div>
        <form id="loginForm" class="space-y-6">
          <div>
            <label for="setor" class="block text-sm font-medium text-gray-700 mb-2">Setor</label>
            <select id="setor" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <option value="">Carregando setores...</option>
            </select>
          </div>
          <div>
            <label for="senha" class="block text-sm font-medium text-gray-700 mb-2">Senha do setor</label>
            <input type="password" id="senha" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Digite a senha do setor"/>
          </div>
          <div id="connectionStatus" class="text-center text-sm"><span class="badge badge-green">üìÑ planilha.json carregado e conectado</span></div>
          <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300 transform hover:scale-105 shadow-lg">Entrar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Menu -->
  <div id="mainMenu" class="hidden min-h-full p-4">
    <div class="max-w-md mx-auto">
      <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
        <div class="text-center">
          <h2 class="text-xl font-bold text-gray-800">Bem-vindo!</h2>
          <p class="text-gray-600" id="setorAtual">Setor: </p>
        </div>
      </div>

      <div class="space-y-4">
        <button onclick="showScreen('retiradaScreen')" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transition duration-300 transform hover:scale-105">
          <div class="text-4xl mb-2">üì§</div>
          <div class="text-xl font-bold">Retirada de Objeto</div>
        </button>
        <button onclick="showScreen('devolucaoScreen')" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transition duration-300 transform hover:scale-105">
          <div class="text-4xl mb-2">üì•</div>
          <div class="text-xl font-bold">Devolu√ß√£o de Objeto</div>
        </button>
        <button onclick="showScreen('inventarioScreen')" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transition duration-300 transform hover:scale-105">
          <div class="text-4xl mb-2">üìã</div>
          <div class="text-xl font-bold">Invent√°rio de Fim de Turno</div>
        </button>
        <button onclick="logout()" class="w-full bg-gray-200 text-gray-700 p-4 rounded-xl hover:bg-gray-300 transition duration-300 mt-4">
          <div class="text-sm font-semibold">üö™ Sair</div>
        </button>
      </div>
    </div>
  </div>

  <!-- Retirada -->
  <div id="retiradaScreen" class="hidden min-h-full p-4">
    <div class="max-w-md mx-auto">
      <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2">üì§</span> Retirada de Objeto</h2>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-2">Matr√≠cula do Funcion√°rio:</label>
          <input type="text" id="matriculaRetirada" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Digite a matr√≠cula" />
          <button onclick="identificarPorMatricula('retirada')" class="mt-2 w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-300">Identificar</button>
        </div>
        <div id="funcionarioInfoRetirada" class="hidden bg-green-50 border-2 border-green-500 rounded-xl p-4 mb-4"></div>
        <div id="leituraInfoRetirada" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-sm text-gray-700"></div>
        <div id="objetoSelectionRetirada" class="hidden">
          <label class="block text-sm font-medium text-gray-700 mb-2">Selecione o Objeto:</label>
          <select id="objetoRetirada" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mb-4">
            <option value="">Selecione um objeto...</option>
          </select>
          <button onclick="confirmarRetirada()" class="mt-3 w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition duration-300">Confirmar Retirada</button>
        </div>
        <button onclick="voltarMenu()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-300 mt-4">‚Üê Voltar ao Menu</button>
      </div>
    </div>
  </div>

  <!-- Devolu√ß√£o -->
  <div id="devolucaoScreen" class="hidden min-h-full p-4">
    <div class="max-w-md mx-auto">
      <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2">üì•</span> Devolu√ß√£o de Objeto</h2>
        <div id="listaDevolucao" class="space-y-2"></div>
        <p id="msgSemEmUso" class="hidden text-sm text-gray-500">N√£o h√° objetos em uso neste setor.</p>
        <button id="btnConfirmaDevolucao" onclick="confirmarDevolucao()" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition duration-300 mt-3 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed" disabled>Confirmar Devolu√ß√£o</button>
        <button onclick="voltarMenu()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-300 mt-4">‚Üê Voltar ao Menu</button>
      </div>
    </div>
  </div>

  <!-- Invent√°rio -->
  <div id="inventarioScreen" class="hidden min-h-full p-4">
    <div class="max-w-md mx-auto">
      <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2">üìã</span> Invent√°rio de Fim de Turno</h2>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-2">Matr√≠cula do Funcion√°rio:</label>
          <input type="text" id="matriculaInventario" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Digite a matr√≠cula" />
          <button onclick="identificarPorMatricula('inventario')" class="mt-2 w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-300">Identificar</button>
        </div>
        <div id="funcionarioInfoInventario" class="hidden bg-green-50 border-2 border-green-500 rounded-xl p-4 mb-4"></div>
        <div id="leituraInfoInventario" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-sm text-gray-700"></div>
        <div id="statusObjetosInventario" class="hidden mb-4">
          <h3 class="text-lg font-semibold text-gray-800 mb-3">Objetos do setor e status atual:</h3>
          <div id="listaObjetosInventario" class="space-y-2"></div>
          <div id="inventarioAviso" class="mt-2"></div>
        </div>
        <div id="inventarioActions" class="hidden">
          <button id="btnFinalizarInventario" onclick="finalizarInventario()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition duration-300 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed">Finalizar Invent√°rio</button>
        </div>
        <button onclick="voltarMenu()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-300 mt-4">‚Üê Voltar ao Menu</button>
      </div>
    </div>
  </div>

  <!-- Modal confirm -->
  <div id="confirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 transform transition-all">
      <div class="text-center mb-6">
        <div class="text-4xl mb-3" id="confirmIcon">‚ùì</div>
        <h3 class="text-xl font-bold text-gray-800 mb-2" id="confirmTitle">Confirmar A√ß√£o</h3>
        <p class="text-gray-600" id="confirmMessage"></p>
      </div>
      <div class="flex space-x-3">
        <button onclick="cancelConfirm()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition duration-300">N√£o</button>
        <button id="confirmButton" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">Sim</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="hidden fixed top-20 right-4 z-50 max-w-sm">
    <div id="toastContent" class="rounded-xl shadow-2xl p-4 transform transition-all"></div>
  </div>

  <!-- Iframe oculto para submit do Google Forms -->
  <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

  <script>
  // =================== CONFIG FORMS (mapeamento corrigido) ===================
  // Endpoint oficial do seu formul√°rio (d/e/<ID>/formResponse)
  const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLScKBnRZ2StGX5qIqGVPrsXbt-hTbTawDYWqR3iEELCq9of7Xw/formResponse';

  // ATEN√á√ÉO: mapeamento corrigido segundo o seu link pr√©-preenchido
  // entry.2075298705 -> Tipo de A√ß√£o (Retirada / Devolu√ß√£o / Invent√°rio de Final de Turno)
  // entry.1169418597  -> Detalhes extras (Em Uso / Devolvido)
  const FORMS_FIELDS = {
    objeto: 'entry.587663124',
    matricula: 'entry.360956002',
    funcionario: 'entry.245251034',
    setor: 'entry.431322508',
    timestamp: 'entry.2072805918',
    tipoAcao: 'entry.2075298705',
    detalhe: 'entry.1169418597'
  };

  // =================== PLANILHA.JSON (mock simplificado p/ exemplo) ===================
  const PLANILHA = {
    setoresSenha: { 'Teste': '1234' },
    objetos: { 'Teste': ['FACA TESTE'] },
    funcionarios: [ { matricula:'10000', nome:'USUARIO TESTE', setor:'Teste' } ]
  };

  // =================== ESTADO ===================
  let currentSetor = '';
  let currentFuncionario = null; // {id, nome}
  let objetoSelecionadoDevolucao = null;
  let statusPorObjeto = {}; // { nome: {status:'Em Uso'|'Devolvido', nome, matricula, data} }

  // =================== UI Helpers ===================
  function showToast(message, type='success'){
    const toast=document.getElementById('toast');
    const toastContent=document.getElementById('toastContent');
    const bg= type==='success'?'bg-green-500':'bg-red-500';
    const icon= type==='success'?'‚úÖ':'‚ùå';
    toastContent.className=`rounded-xl shadow-2xl p-4 text-white ${bg}`;
    toastContent.innerHTML=`<div class="flex items-center space-x-3"><div class="text-2xl">${icon}</div><div class="flex-1 font-semibold">${message}</div></div>`;
    toast.classList.remove('hidden');
    setTimeout(()=>toast.classList.add('hidden'),3200);
  }

  // =================== LOGIN ===================
  function loadSetores(){
    const sel = document.getElementById('setor');
    sel.innerHTML = '<option value="">Selecione um setor...</option>';
    Object.keys(PLANILHA.objetos).forEach(s=>{
      const o=document.createElement('option'); o.value=s; o.textContent=s; sel.appendChild(o);
    });
  }
  loadSetores();

  document.getElementById('loginForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const setor=document.getElementById('setor').value;
    const senha=document.getElementById('senha').value;
    if(!setor){ showToast('Selecione o setor','error'); return; }
    if((PLANILHA.setoresSenha?.[setor]||'')!==String(senha)){ showToast('Senha do setor incorreta','error'); return; }
    currentSetor=setor; document.getElementById('setorAtual').textContent='Setor: '+currentSetor;
    showScreen('mainMenu'); showToast('Login realizado com sucesso!');
  });

  function showScreen(id){
    ['loginScreen','mainMenu','retiradaScreen','devolucaoScreen','inventarioScreen'].forEach(s=>document.getElementById(s).classList.add('hidden'));
    const el=document.getElementById(id); el.classList.remove('hidden'); el.classList.add('fade-in');
    if(id==='retiradaScreen') loadObjetosDisponiveis();
    if(id==='devolucaoScreen') montarDevolucao();
    if(id==='inventarioScreen') prepararInventario();
  }
  function voltarMenu(){ currentFuncionario=null; objetoSelecionadoDevolucao=null; showScreen('mainMenu'); }
  function logout(){ currentSetor=''; currentFuncionario=null; objetoSelecionadoDevolucao=null; document.getElementById('senha').value=''; document.getElementById('setor').value=''; showScreen('loginScreen'); }

  // =================== FUNCION√ÅRIO ===================
  function identificarPorMatricula(ctx){
    const inputId = (ctx==='retirada') ? 'matriculaRetirada' : 'matriculaInventario';
    const m = (document.getElementById(inputId).value||'').trim();
    const f = PLANILHA.funcionarios.find(x=>String(x.matricula)===m);
    if(!f){ showToast('Matr√≠cula n√£o encontrada','error'); return; }
    currentFuncionario = { id:f.matricula, nome:f.nome };
    if(ctx==='retirada'){
      document.getElementById('funcionarioInfoRetirada').classList.remove('hidden');
      document.getElementById('funcionarioInfoRetirada').innerHTML=`<div><b>Matr√≠cula:</b> ${f.matricula}</div><div class='mt-1'><b>Nome:</b> ${f.nome}</div>`;
      document.getElementById('leituraInfoRetirada').classList.remove('hidden');
      document.getElementById('leituraInfoRetirada').innerHTML=`<div><b>Identificado em:</b> ${new Date().toLocaleString('pt-BR')}</div>`;
      document.getElementById('objetoSelectionRetirada').classList.remove('hidden');
    }
    if(ctx==='inventario'){
      document.getElementById('funcionarioInfoInventario').classList.remove('hidden');
      document.getElementById('funcionarioInfoInventario').innerHTML=`<div><b>Matr√≠cula:</b> ${f.matricula}</div><div class='mt-1'><b>Nome:</b> ${f.nome}</div>`;
      document.getElementById('leituraInfoInventario').classList.remove('hidden');
      document.getElementById('leituraInfoInventario').innerHTML=`<div><b>Identificado em:</b> ${new Date().toLocaleString('pt-BR')}</div>`;
    }
  }

  // =================== OBJETOS ===================
  function objetosDoSetorAtual(){ return PLANILHA.objetos?.[currentSetor] || []; }
  function loadObjetosDisponiveis(){
    const sel = document.getElementById('objetoRetirada');
    sel.innerHTML='<option value="">Selecione um objeto...</option>';
    objetosDoSetorAtual().forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; sel.appendChild(o); });
  }

  // =================== Devolu√ß√£o (listar em uso) ===================
  function montarDevolucao(){
    const wrap = document.getElementById('listaDevolucao');
    const btn = document.getElementById('btnConfirmaDevolucao');
    const msg = document.getElementById('msgSemEmUso');
    wrap.innerHTML=''; btn.disabled=true; msg.classList.add('hidden');

    const objsSetor = new Set(objetosDoSetorAtual());
    const emUso = Object.entries(statusPorObjeto).filter(([obj,info])=> objsSetor.has(obj) && info?.status==='Em Uso');
    if(emUso.length===0){ msg.classList.remove('hidden'); return; }
    wrap.addEventListener('change', ev=>{ if(ev.target && ev.target.name==='dev_obj'){ objetoSelecionadoDevolucao = ev.target.value; btn.disabled = !objetoSelecionadoDevolucao; } });
    emUso.forEach(([obj,info],idx)=>{
      const id='dev_'+idx;
      const row=document.createElement('label'); row.className='flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer';
      row.innerHTML = `<input type="radio" name="dev_obj" id="${id}" value="${obj}" class="mt-1.5"/>`+
        `<div class="flex-1"><div class="font-semibold text-gray-800">${obj}</div>`+
        `<div class="text-xs text-gray-600">em uso por <b>${info.nome||info.matricula||'?'} </b> em ${info.data? new Date(info.data).toLocaleString('pt-BR'):'?'}</div></div>`;
      wrap.appendChild(row);
    });
  }

  // =================== INVENT√ÅRIO ===================
  function prepararInventario(){
    const container=document.getElementById('listaObjetosInventario');
    const statusDiv=document.getElementById('statusObjetosInventario');
    const actionsDiv=document.getElementById('inventarioActions');
    const avisoDiv=document.getElementById('inventarioAviso');

    container.innerHTML='';
    const lista=objetosDoSetorAtual();
    if(lista.length===0){ container.innerHTML='<p class="text-gray-500 text-center py-4">Nenhum objeto encontrado para este setor.</p>'; statusDiv.classList.remove('hidden'); actionsDiv.classList.add('hidden'); return; }

    let algumEmUso=false;
    lista.forEach(nome=>{
      const info=statusPorObjeto[nome];
      const emUso = info && info.status==='Em Uso';
      if(emUso) algumEmUso=true;
      const badge = emUso? '<span class="badge badge-yellow">Em Uso</span>' : '<span class="badge badge-green">Devolvido</span>';
      const extra = emUso? `<div class='text-xs text-gray-600'>por <b>${info.nome||info.matricula||'?'} </b> em ${info.data? new Date(info.data).toLocaleString('pt-BR'):'?'}</div>` : '';
      const row=document.createElement('div'); row.className='flex items-start justify-between p-3 border border-gray-200 rounded-lg';
      row.innerHTML=`<div class="font-semibold text-gray-800">${nome}</div><div class="text-right">${badge}${extra? `<div>${extra}</div>`:''}</div>`;
      container.appendChild(row);
    });
    statusDiv.classList.remove('hidden'); actionsDiv.classList.remove('hidden');
    const btn=document.getElementById('btnFinalizarInventario');
    if(algumEmUso){ btn.disabled=true; avisoDiv.innerHTML='<div class="text-sm text-red-700 bg-red-50 border border-red-200 rounded-lg p-2">H√° objeto(s) <b>Em Uso</b>. Finaliza√ß√£o bloqueada.</div>'; }
    else { btn.disabled=false; avisoDiv.innerHTML='<div class="text-sm text-green-700 bg-green-50 border border-green-200 rounded-lg p-2">Todos os objetos est√£o <b>Devolvidos</b>. Voc√™ pode finalizar o invent√°rio.</div>'; }
  }

  // =================== Envio ao Forms (via <form target=iframe>) ===================
  function postToForms({ objeto, matricula, funcionario, setor, timestampISO, acao, detalhe }){
    const form = document.createElement('form'); form.action = GOOGLE_FORM_URL; form.method='POST'; form.target='hidden_iframe';
    const add = (name, value)=>{ const i=document.createElement('input'); i.type='hidden'; i.name=name; i.value=value||''; form.appendChild(i); };
    add(FORMS_FIELDS.objeto, objeto||'');
    add(FORMS_FIELDS.matricula, matricula||'');
    add(FORMS_FIELDS.funcionario, funcionario||'');
    add(FORMS_FIELDS.setor, setor||'');
    add(FORMS_FIELDS.timestamp, timestampISO||new Date().toISOString());
    // Campos de m√∫ltipla escolha / checkbox DEVEM receber o r√≥tulo exato
    if(acao)   add(FORMS_FIELDS.tipoAcao, acao);          // Retirada | Devolu√ß√£o | Invent√°rio de Final de Turno
    if(detalhe) add(FORMS_FIELDS.detalhe, detalhe);       // Em Uso | Devolvido
    document.body.appendChild(form); form.submit(); document.body.removeChild(form);
  }

  // =================== A√ß√µes ===================
  function confirmarRetirada(){
    const objeto=(document.getElementById('objetoRetirada').value||'').trim();
    if(!objeto){ showToast('Selecione um objeto do dropdown','error'); return; }
    if(!currentFuncionario){ showToast('Identifique o funcion√°rio','error'); return; }
    const nome=currentFuncionario.nome; const mat=currentFuncionario.id; const setor=currentSetor;
    showConfirm(`Confirma a retirada do objeto "${objeto}"?`, ()=>{
      postToForms({ objeto, matricula:mat, funcionario:nome, setor, timestampISO:new Date().toISOString(), acao:'Retirada', detalhe:'Em Uso' });
      statusPorObjeto[objeto]={ status:'Em Uso', nome, matricula:mat, data:new Date() };
      showToast('Retirada registrada com sucesso!'); voltarMenu();
    });
  }

  function confirmarDevolucao(){
    if(!objetoSelecionadoDevolucao){ showToast('Selecione um objeto em uso','error'); return; }
    const objeto=objetoSelecionadoDevolucao; const info=statusPorObjeto[objeto]||{}; const setor=currentSetor;
    showConfirm(`Confirmar devolu√ß√£o do objeto "${objeto}"?`, ()=>{
      postToForms({ objeto, matricula:info.matricula||'', funcionario:info.nome||'', setor, timestampISO:new Date().toISOString(), acao:'Devolu√ß√£o', detalhe:'Devolvido' });
      statusPorObjeto[objeto]={ status:'Devolvido', nome:'', matricula:'', data:new Date() };
      showToast('Devolu√ß√£o registrada com sucesso!'); montarDevolucao();
    });
  }

  function finalizarInventario(){
    if(!currentFuncionario){ showToast('Identifique o funcion√°rio','error'); return; }
    const lista=objetosDoSetorAtual(); const algumEmUso=lista.some(o=> statusPorObjeto[o]?.status==='Em Uso');
    if(algumEmUso){ showToast('H√° objeto(s) Em Uso. Finaliza√ß√£o bloqueada.','error'); return; }
    const nome=currentFuncionario.nome; const mat=currentFuncionario.id; const setor=currentSetor;
    showConfirm('Confirmar finaliza√ß√£o do invent√°rio (todos como Devolvido)?', ()=>{
      lista.forEach(objeto=>{
        postToForms({ objeto, matricula:mat, funcionario:nome, setor, timestampISO:new Date().toISOString(), acao:'Invent√°rio de Final de Turno', detalhe:'Devolvido' });
        statusPorObjeto[objeto]={ status:'Devolvido', nome:'', matricula:'', data:new Date() };
      });
      showToast('Invent√°rio finalizado e enviado!'); voltarMenu();
    });
  }

  // =================== Modal ===================
  let confirmCallback=null; function showConfirm(msg, cb){ const m=document.getElementById('confirmModal'); document.getElementById('confirmMessage').textContent=msg; m.classList.remove('hidden'); confirmCallback=cb; document.getElementById('confirmButton').onclick=()=>{ m.classList.add('hidden'); if(confirmCallback){ confirmCallback(); confirmCallback=null; } }; }
  function cancelConfirm(){ document.getElementById('confirmModal').classList.add('hidden'); confirmCallback=null; }
  </script>
</body>
</html>