<!DOCTYPE html><html lang="pt-BR"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Diagn√≥stico KnifeControl</title><style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans','Liberation Sans',sans-serif;margin:16px}.card{border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin-bottom:16px}.ok{color:#065f46}.warn{color:#92400e}.err{color:#991b1b}code,pre{background:#f9fafb;padding:2px 4px;border-radius:6px}</style></head><body><h1>üîß Diagn√≥stico ‚Äî KnifeControl</h1><div class=card><div><b>Host:</b> <code id=host></code></div><div><b>Protocol:</b> <code id=proto></code> <span id=secure></span></div><div><b>Data/Hora:</b> <code id=now></code></div></div><div class=card><h2>üìÑ planilha.json</h2><div id=planStatus>Verificando...</div><div>üë• Funcion√°rios: <code id=fnCount>‚Äî</code></div><div>üè∑Ô∏è Setores (login): <code id=stCount>‚Äî</code></div><div>üß∞ Objetos (total): <code id=objCount>‚Äî</code></div><div>üî¢ M√°scara da matr√≠cula (regex): <code>^\d{4,5}$</code></div><pre id=planInfo style="white-space:pre-wrap"></pre></div><div class=card><h2>üìä GViz (Google Sheets)</h2><div>URL: <code>https://docs.google.com/spreadsheets/d/1k3K5NBme5EklfF4o_yfSCJzTSXrXFA2AKdFFvnkeMcE/gviz/tq?tqx=out:json&gid=324654921</code></div><div id=gvizStatus>Verificando...</div><pre id=gvizInfo style="white-space:pre-wrap"></pre></div><script>(function(){const $=id=>document.getElementById(id);$('host').textContent=location.hostname; $('proto').textContent=location.protocol;$('secure').innerHTML=(location.protocol==='https:'||location.hostname==='localhost')?' <span class=ok>‚úÖ contexto seguro</span>':' <span class=err>‚ùå n√£o seguro</span>';$('now').textContent=new Date().toLocaleString('pt-BR');async function checkPlanilha(){try{const r=await fetch('./planilha.json',{cache:'no-store'});const txt=await r.text();$('planStatus').innerHTML=(r.ok?'<span class=ok>‚úÖ '+r.status+'</span>':'<span class=err>‚ùå '+r.status+'</span>');try{const j=JSON.parse(txt);const funcionarios=Array.isArray(j.funcionarios)?j.funcionarios:[];let setores=[];if(Array.isArray(j.setoresAtivos)&&j.setoresAtivos.length>0){setores=j.setoresAtivos.slice();}else if(Array.isArray(j.setores)&&j.setores.length>0){setores=j.setores.slice();}else{const set=new Set();(funcionarios||[]).forEach(f=>{if(f&&f.setor)set.add(String(f.setor).trim())});setores=Array.from(set);}let objTotal=0;if(j.objetos&&typeof j.objetos==='object'){for(const k in j.objetos){if(Array.isArray(j.objetos[k]))objTotal+=j.objetos[k].length}}$('fnCount').textContent=funcionarios.length; $('stCount').textContent=setores.length; $('objCount').textContent=objTotal;$('planInfo').textContent='Chaves: '+Object.keys(j).join(', ');}catch(e){$('planInfo').textContent='Conte√∫do n√£o-JSON ou inv√°lido.\n'+txt.slice(0,2000);}}catch(e){$('planStatus').innerHTML='<span class=err>‚ùå erro</span>'; $('planInfo').textContent=String(e)}}async function checkGViz(){const url='https://docs.google.com/spreadsheets/d/1k3K5NBme5EklfF4o_yfSCJzTSXrXFA2AKdFFvnkeMcE/gviz/tq?tqx=out:json&gid=324654921';try{const r=await fetch(url,{cache:'no-store'});const t=await r.text();const ok=r.ok&&t.includes('google.visualization.Query.setResponse');$('gvizStatus').innerHTML=ok?'<span class=ok>‚úÖ '+r.status+' (GViz)</span>':'<span class=warn>‚ö†Ô∏è '+r.status+' (conte√∫do inesperado)</span>'; $('gvizInfo').textContent=t.slice(0,1000);}catch(e){$('gvizStatus').innerHTML='<span class=err>‚ùå erro</span>'; $('gvizInfo').textContent=String(e)}}checkPlanilha(); checkGViz();})();</script></body></html>